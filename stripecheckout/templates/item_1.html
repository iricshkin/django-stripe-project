{% load static %}
{% load mathfilters %}
<!DOCTYPE html>
<html>
  <head>
    <title>Товар||{{ item.name }}</title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="stylesheet" href="{% static 'stripecheckout/css/style.css' %}">
      <script src="https://js.stripe.com/v3/"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>
  </head>
  <body>
  <input type="hidden" id="myVar" name="variable" value="{{ order.id }}">
  <div id="column">
  
        <table class="horizontal">
          <tr>
            <td>{{ item.name }}</td>
            <td>{{ item.description }}</td>
            <td>{{ item.price }} {{item.currency}}</td>
          </tr>
        </table>
  </div>

  <button id="submit">
    <div class="spinner hidden" id="spinner"></div>
    <span id="button-text">Bay</span>
  </button>
  <script src="https://js.stripe.com/v3/"></script>
  <script type="text/javascript">
    var stripe = Stripe('STRIPE_PUBLISHABLE_KEY');
    var buyButton    = document.getElementById('buy-button');
    buyButton.addEventListener('click', () => myFunc('/buy/{{item.pk}}'));

    function myFunc(url) {
      fetch(url, {method: 'GET'})
      .then(response => {return response.json()})
      .then(session => stripe.redirectToCheckout({ sessionId: session.session_id}))
    };
  </script>
    
</body>
</html>
